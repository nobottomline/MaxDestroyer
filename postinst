#!/bin/bash

# Устанавливаем настройки по умолчанию
defaults write com.greatlove.maxdestroyer enabled -bool true
defaults write com.greatlove.maxdestroyer targetBundleID -string "com.greatlove.maxdestroyer"
defaults write com.greatlove.maxdestroyer alertTitle -string "Не удалось открыть приложение"
defaults write com.greatlove.maxdestroyer alertMessage -string "Произошла критическая ошибка при инициализации приложения. Код ошибки: 0x80004005. Попробуйте переустановить приложение или обратитесь в службу поддержки."

# Устанавливаем правильные права доступа
chown mobile:mobile /var/mobile/Library/Preferences/com.greatlove.maxdestroyer.plist
chmod 644 /var/mobile/Library/Preferences/com.greatlove.maxdestroyer.plist

# Копируем entry.plist в правильное место для PreferenceLoader
mkdir -p /Library/PreferenceLoader/Preferences
cp /Library/PreferenceBundles/MaxDestroyerPreferences.bundle/entry.plist /Library/PreferenceLoader/Preferences/MaxDestroyer.plist

# Устанавливаем права доступа
chown root:wheel /Library/PreferenceLoader/Preferences/MaxDestroyer.plist
chmod 644 /Library/PreferenceLoader/Preferences/MaxDestroyer.plist

# Также копируем в альтернативное место
mkdir -p /var/mobile/Library/Preferences
cp /Library/PreferenceBundles/MaxDestroyerPreferences.bundle/entry.plist /var/mobile/Library/Preferences/MaxDestroyer.plist
chown mobile:mobile /var/mobile/Library/Preferences/MaxDestroyer.plist
chmod 644 /var/mobile/Library/Preferences/MaxDestroyer.plist

echo "MaxDestroyer настроен и готов к работе!"
